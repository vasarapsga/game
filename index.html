<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Racer - –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ—Ä –ì–æ–Ω–∫–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a0033 50%, #000066 100%);
            overflow: hidden;
            color: #fff;
            -webkit-user-select: none;
            user-select: none;
        }

        #gameContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #menu {
            text-align: center;
            z-index: 100;
            animation: glow 2s ease-in-out infinite alternate;
        }

        #menu h1 {
            font-size: clamp(2em, 8vw, 3.5em);
            background: linear-gradient(45deg, #ff00ff, #00ffff, #ffff00);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
        }

        .menu-btn {
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            border: none;
            padding: clamp(10px, 3vw, 15px) clamp(20px, 5vw, 30px);
            margin: 10px;
            font-size: clamp(1em, 3vw, 1.2em);
            color: #000;
            font-weight: bold;
            cursor: pointer;
            border-radius: 25px;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.3);
        }

        .menu-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.8);
        }

        #gameCanvas {
            border: 2px solid #00ffff;
            border-radius: 10px;
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.5);
            display: none;
            background: linear-gradient(180deg, #000033 0%, #000066 100%);
            max-width: 100%;
            max-height: 100%;
        }

        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 50;
            font-size: clamp(0.8em, 2.5vw, 1em);
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }

        #controls {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            font-size: clamp(0.7em, 2vw, 0.9em);
            opacity: 0.7;
        }

        #touchControls {
            position: absolute;
            bottom: 10px;
            width: 100%;
            display: none;
            justify-content: space-between;
            padding: 0 10px;
            z-index: 100;
        }

        .touch-btn {
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            border: none;
            padding: clamp(15px, 4vw, 20px);
            border-radius: 50%;
            font-size: clamp(1em, 3vw, 1.2em);
            color: #000;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.5);
            width: clamp(50px, 15vw, 60px);
            height: clamp(50px, 15vw, 60px);
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: none;
        }

        #musicControls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 50;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, #fff, transparent);
            border-radius: 50%;
            pointer-events: none;
            animation: float 3s linear infinite;
        }

        @keyframes glow {
            0% { text-shadow: 0 0 20px rgba(255, 0, 255, 0.5); }
            100% { text-shadow: 0 0 40px rgba(0, 255, 255, 0.8); }
        }

        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }

        .hidden { display: none !important; }

        @media (max-width: 768px) {
            #gameCanvas {
                width: 100vw !important;
                height: calc(100vw * 0.6) !important;
            }

            #touchControls {
                display: flex;
            }

            #controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="menu">
            <h1>NEON RACER</h1>
            <button class="menu-btn" onclick="startGame()">üèÅ –°–¢–ê–†–¢</button>
            <button class="menu-btn" onclick="showControls()">‚öôÔ∏è –£–ü–†–ê–í–õ–ï–ù–ò–ï</button>
            <button class="menu-btn" onclick="showHighScore()">üèÜ –†–ï–ö–û–†–î–´</button>
        </div>

        <canvas id="gameCanvas" width="1000" height="600"></canvas>
        
        <div id="ui" class="hidden">
            <div>–û—á–∫–∏: <span id="score">0</span></div>
            <div>–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></div>
            <div>–ñ–∏–∑–Ω–∏: <span id="lives">3</span></div>
            <button onclick="pauseGame()" style="margin-top: 10px; padding: 5px 10px; background: #ff00ff; border: none; color: #000; border-radius: 5px; cursor: pointer;">‚è∏Ô∏è –ü–ê–£–ó–ê</button>
        </div>

        <div id="controls" class="hidden">
            <div>üéÆ WASD –∏–ª–∏ ‚Üê ‚Üí ‚Üë ‚Üì - –¥–≤–∏–∂–µ–Ω–∏–µ | SPACE - –ø—Ä—ã–∂–æ–∫ | ESC - –º–µ–Ω—é</div>
        </div>

        <div id="touchControls" class="hidden">
            <div>
                <button class="touch-btn" id="leftBtn">‚Üê</button>
                <button class="touch-btn" id="rightBtn">‚Üí</button>
            </div>
            <button class="touch-btn" id="jumpBtn">‚Üë</button>
        </div>

        <div id="musicControls">
            <button class="touch-btn" id="musicBtn">üîä</button>
        </div>
    </div>

    <audio id="backgroundMusic" loop>
        <source src="https://www.newgrounds.com/audio/listen/412757" type="audio/mp3">
    </audio>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let canvas, ctx;
        let gameState = 'menu';
        let score = 0, level = 1, lives = 3;
        let animationId;
        let isPaused = false;
        let highScore = parseInt(localStorage.getItem('neonRacerHighScore')) || 0;
        let isMusicPlaying = false;
        const audio = document.getElementById('backgroundMusic');

        // –ò–≥—Ä–æ–∫
        let player = {
            x: 100,
            y: 400,
            width: 30,
            height: 30,
            vx: 0,
            vy: 0,
            speed: 5,
            jumpPower: 15,
            onGround: false,
            color: '#ff00ff',
            trail: []
        };

        let platforms = [];
        let enemies = [];
        let collectibles = [];
        let particles = [];
        let keys = {};
        let touchControls = {
            left: false,
            right: false,
            jump: false
        };

        function init() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            adjustCanvasSize();
            window.addEventListener('resize', adjustCanvasSize);
            
            createParticles();
            setupTouchControls();
            setupMusicControls();
            
            document.addEventListener('keydown', (e) => {
                keys[e.code] = true;
                if (e.code === 'Escape') {
                    if (gameState === 'playing') pauseGame();
                    else if (gameState === 'paused') resumeGame();
                }
            });
            
            document.addEventListener('keyup', (e) => {
                keys[e.code] = false;
            });
        }

        function adjustCanvasSize() {
            const maxWidth = window.innerWidth;
            const maxHeight = window.innerHeight;
            const aspectRatio = 1000 / 600;
            
            if (maxWidth / maxHeight > aspectRatio) {
                canvas.height = Math.min(maxHeight, 600);
                canvas.width = canvas.height * aspectRatio;
            } else {
                canvas.width = Math.min(maxWidth, 1000);
                canvas.height = canvas.width / aspectRatio;
            }
        }

        function createParticles() {
            for (let i = 0; i < 50; i++) {
                createParticle();
            }
        }

        function createParticle() {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + 'vw';
            particle.style.animationDelay = Math.random() * 3 + 's';
            document.body.appendChild(particle);
            
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 3000);
        }

        function setupTouchControls() {
            const leftBtn = document.getElementById('leftBtn');
            const rightBtn = document.getElementById('rightBtn');
            const jumpBtn = document.getElementById('jumpBtn');

            leftBtn.addEventListener('touchstart', () => touchControls.left = true);
            leftBtn.addEventListener('touchend', () => touchControls.left = false);
            rightBtn.addEventListener('touchstart', () => touchControls.right = true);
            rightBtn.addEventListener('touchend', () => touchControls.right = false);
            jumpBtn.addEventListener('touchstart', () => {
                if (player.onGround) touchControls.jump = true;
            });
            jumpBtn.addEventListener('touchend', () => touchControls.jump = false);

            [leftBtn, rightBtn, jumpBtn].forEach(btn => {
                btn.addEventListener('touchstart', (e) => e.preventDefault());
            });
        }

        function setupMusicControls() {
            const musicBtn = document.getElementById('musicBtn');
            musicBtn.addEventListener('click', toggleMusic);
            musicBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                toggleMusic();
            });
        }

        function toggleMusic() {
            if (isMusicPlaying) {
                audio.pause();
                document.getElementById('musicBtn').textContent = 'üîá';
            } else {
                audio.play().catch(e => console.log('Audio play failed:', e));
                document.getElementById('musicBtn').textContent = 'üîä';
            }
            isMusicPlaying = !isMusicPlaying;
        }

        function startGame() {
            gameState = 'playing';
            score = 0;
            level = 1;
            lives = 3;
            
            document.getElementById('menu').classList.add('hidden');
            document.getElementById('gameCanvas').style.display = 'block';
            document.getElementById('ui').classList.remove('hidden');
            document.getElementById('controls').classList.remove('hidden');
            if (isMobile()) {
                document.getElementById('touchControls').classList.remove('hidden');
            }
            
            resetPlayer();
            generateLevel();
            gameLoop();
            
            if (isMusicPlaying) audio.play().catch(e => console.log('Audio play failed:', e));
            setInterval(createParticle, 100);
        }

        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
        }

        function resetPlayer() {
            player.x = canvas.width * 0.1;
            player.y = canvas.height * 0.67;
            player.width = canvas.width * 0.03;
            player.height = canvas.width * 0.03;
            player.vx = 0;
            player.vy = 0;
            player.onGround = false;
            player.trail = [];
        }

        function generateLevel() {
            platforms = [];
            enemies = [];
            collectibles = [];

            const scaleX = canvas.width / 1000;
            const scaleY = canvas.height / 600;

            platforms.push({
                x: 0,
                y: canvas.height * 0.92,
                width: canvas.width,
                height: canvas.height * 0.083,
                color: '#00ffff'
            });

            switch(level) {
                case 1:
                    platforms.push(...[
                        {x: 200 * scaleX, y: 450 * scaleY, width: 150 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 400 * scaleX, y: 350 * scaleY, width: 150 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 600 * scaleX, y: 250 * scaleY, width: 150 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 800 * scaleX, y: 150 * scaleY, width: 150 * scaleX, height: 20 * scaleY, color: '#ff00ff'}
                    ]);
                    enemies.push(...[
                        {x: 250 * scaleX, y: 420 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: 2 * scaleX, color: '#ff4444', minX: 200 * scaleX, maxX: 350 * scaleX},
                        {x: 450 * scaleX, y: 320 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: -2 * scaleX, color: '#ff4444', minX: 400 * scaleX, maxX: 550 * scaleX}
                    ]);
                    collectibles.push(...[
                        {x: 230 * scaleX, y: 400 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 430 * scaleX, y: 300 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 630 * scaleX, y: 200 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 830 * scaleX, y: 100 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false}
                    ]);
                    break;

                case 2:
                    platforms.push(...[
                        {x: 100 * scaleX, y: 500 * scaleY, width: 100 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 300 * scaleX, y: 400 * scaleY, width: 80 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 500 * scaleX, y: 300 * scaleY, width: 80 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 700 * scaleX, y: 200 * scaleY, width: 80 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 850 * scaleX, y: 100 * scaleY, width: 120 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 150 * scaleX, y: 250 * scaleY, width: 100 * scaleX, height: 20 * scaleY, color: '#ffff00'},
                        {x: 600 * scaleX, y: 450 * scaleY, width: 100 * scaleX, height: 20 * scaleY, color: '#ffff00'}
                    ]);
                    enemies.push(...[
                        {x: 120 * scaleX, y: 470 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: 1.5 * scaleX, color: '#ff4444', minX: 100 * scaleX, maxX: 200 * scaleX},
                        {x: 320 * scaleX, y: 370 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: -1.5 * scaleX, color: '#ff4444', minX: 300 * scaleX, maxX: 380 * scaleX},
                        {x: 520 * scaleX, y: 270 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: 1.5 * scaleX, color: '#ff4444', minX: 500 * scaleX, maxX: 580 * scaleX},
                        {x: 720 * scaleX, y: 170 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: -2 * scaleX, color: '#ff4444', minX: 700 * scaleX, maxX: 780 * scaleX}
                    ]);
                    collectibles.push(...[
                        {x: 130 * scaleX, y: 470 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 330 * scaleX, y: 370 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 530 * scaleX, y: 270 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 730 * scaleX, y: 170 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 880 * scaleX, y: 70 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 180 * scaleX, y: 220 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false}
                    ]);
                    break;

                case 3:
                    platforms.push(...[
                        {x: 50 * scaleX, y: 480 * scaleY, width: 60 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 200 * scaleX, y: 420 * scaleY, width: 60 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 350 * scaleX, y: 360 * scaleY, width: 60 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 500 * scaleX, y: 300 * scaleY, width: 60 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 650 * scaleX, y: 240 * scaleY, width: 60 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 800 * scaleX, y: 180 * scaleY, width: 60 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 900 * scaleX, y: 120 * scaleY, width: 80 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 300 * scaleX, y: 180 * scaleY, width: 80 * scaleX, height: 20 * scaleY, color: '#ffff00'},
                        {x: 150 * scaleX, y: 300 * scaleY, width: 80 * scaleX, height: 20 * scaleY, color: '#ffff00'}
                    ]);
                    enemies.push(...[
                        {x: 60 * scaleX, y: 450 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: 1 * scaleX, color: '#ff4444', minX: 50 * scaleX, maxX: 110 * scaleX},
                        {x: 210 * scaleX, y: 390 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: -1 * scaleX, color: '#ff4444', minX: 200 * scaleX, maxX: 260 * scaleX},
                        {x: 360 * scaleX, y: 330 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: 1 * scaleX, color: '#ff4444', minX: 350 * scaleX, maxX: 410 * scaleX},
                        {x: 510 * scaleX, y: 270 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: -1 * scaleX, color: '#ff4444', minX: 500 * scaleX, maxX: 560 * scaleX},
                        {x: 660 * scaleX, y: 210 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: 1 * scaleX, color: '#ff4444', minX: 650 * scaleX, maxX: 710 * scaleX},
                        {x: 810 * scaleX, y: 150 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: -1 * scaleX, color: '#ff4444', minX: 800 * scaleX, maxX: 860 * scaleX}
                    ]);
                    collectibles.push(...[
                        {x: 75 * scaleX, y: 450 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 225 * scaleX, y: 390 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 375 * scaleX, y: 330 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 525 * scaleX, y: 270 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 675 * scaleX, y: 210 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 825 * scaleX, y: 150 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 925 * scaleX, y: 90 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false}
                    ]);
                    break;

                case 4:
                    platforms.push(...[
                        {x: 100 * scaleX, y: 500 * scaleY, width: 120 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 300 * scaleX, y: 450 * scaleY, width: 100 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 480 * scaleX, y: 380 * scaleY, width: 80 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 620 * scaleX, y: 320 * scaleY, width: 80 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 750 * scaleX, y: 250 * scaleY, width: 100 * scaleX, height: 20 * scaleY, color: '#ff00ff'},
                        {x: 50 * scaleX, y: 350 * scaleY, width: 120 * scaleX, height: 20 * scaleY, color: '#ffff00'},
                        {x: 250 * scaleX, y: 280 * scaleY, width: 120 * scaleX, height: 20 * scaleY, color: '#ffff00'},
                        {x: 450 * scaleX, y: 180 * scaleY, width: 120 * scaleX, height: 20 * scaleY, color: '#ffff00'},
                        {x: 700 * scaleX, y: 120 * scaleY, width: 150 * scaleX, height: 20 * scaleY, color: '#ffff00'}
                    ]);
                    enemies.push(...[
                        {x: 120 * scaleX, y: 470 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: 2 * scaleX, color: '#ff4444', minX: 100 * scaleX, maxX: 220 * scaleX},
                        {x: 320 * scaleX, y: 420 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: -2 * scaleX, color: '#ff4444', minX: 300 * scaleX, maxX: 400 * scaleX},
                        {x: 500 * scaleX, y: 350 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: 1.5 * scaleX, color: '#ff4444', minX: 480 * scaleX, maxX: 560 * scaleX},
                        {x: 640 * scaleX, y: 290 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: -1.5 * scaleX, color: '#ff4444', minX: 620 * scaleX, maxX: 700 * scaleX},
                        {x: 770 * scaleX, y: 220 * scaleY, width: 25 * scaleX, height: 25 * scaleY, vx: 2 * scaleX, color: '#ff4444', minX: 750 * scaleX, maxX: 850 * scaleX}
                    ]);
                    collectibles.push(...[
                        {x: 140 * scaleX, y: 470 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 340 * scaleX, y: 420 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 510 * scaleX, y: 350 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 650 * scaleX, y: 290 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 780 * scaleX, y: 220 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 90 * scaleX, y: 320 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 290 * scaleX, y: 250 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false},
                        {x: 490 * scaleX, y: 150 * scaleY, width: 15 * scaleX, height: 15 * scaleY, collected: false}
                    ]);
                    break;

                case 5:
                    platforms.push(...[
                        {x: 80 * scaleX, y: 520 * scaleY, width: 80 * scaleX, height: 15 * scaleY, color: '#ff00ff'},
                        {x: 220 * scaleX, y: 480 * scaleY, width: 60 * scaleX, height: 15 * scaleY, color: '#ff00ff'},
                        {x: 350 * scaleX, y: 430 * scaleY, width: 60 * scaleX, height: 15 * scaleY, color: '#ff00ff'},
                        {x: 480 * scaleX, y: 380 * scaleY, width: 60 * scaleX, height: 15 * scaleY, color: '#ff00ff'},
                        {x: 610 * scaleX, y: 330 * scaleY, width: 60 * scaleX, height: 15 * scaleY, color: '#ff00ff'},
                        {x: 740 * scaleX, y: 280 * scaleY, width: 60 * scaleX, height: 15 * scaleY, color: '#ff00ff'},
                        {x: 850 * scaleX, y: 220 * scaleY, width: 80 * scaleX, height: 15 * scaleY, color: '#ff00ff'},
                        {x: 150 * scaleX, y: 350 * scaleY, width: 100 * scaleX, height: 15 * scaleY, color: '#ffff00'},
                        {x: 400 * scaleX, y: 250 * scaleY, width: 100 * scaleX, height: 15 * scaleY, color: '#ffff00'},
                        {x: 650 * scaleX, y: 150 * scaleY, width: 100 * scaleX, height: 15 * scaleY, color: '#ffff00'},
                        {x: 300 * scaleX, y: 100 * scaleY, width: 150 * scaleX, height: 15 * scaleY, color: '#00ff00'}
                    ]);
                    enemies.push(...[
                        {x: 90 * scaleX, y: 490 * scaleY, width: 20 * scaleX, height: 20 * scaleY, vx: 1.5 * scaleX, color: '#ff4444', minX: 80 * scaleX, maxX: 160 * scaleX},
                        {x: 230 * scaleX, y: 450 * scaleY, width: 20 * scaleX, height: 20 * scaleY, vx: -1.5 * scaleX, color: '#ff4444', minX: 220 * scaleX, maxX: 280 * scaleX},
                        {x: 360 * scaleX, y: 400 * scaleY, width: 20 * scaleX, height: 20 * scaleY, vx: 1.5 * scaleX, color: '#ff4444', minX: 350 * scaleX, maxX: 410 * scaleX},
                        {x: 490 * scaleX, y: 350 * scaleY, width: 20 * scaleX, height: 20 * scaleY, vx: -1.5 * scaleX, color: '#ff4444', minX: 480 * scaleX, maxX: 540 * scaleX},
                        {x: 620 * scaleX, y: 300 * scaleY, width: 20 * scaleX, height: 20 * scaleY, vx: 1.5 * scaleX, color: '#ff4444', minX: 610 * scaleX, maxX: 670 * scaleX},
                        {x: 750 * scaleX, y: 250 * scaleY, width: 20 * scaleX, height: 20 * scaleY, vx: -1.5 * scaleX, color: '#ff4444', minX: 740 * scaleX, maxX: 800 * scaleX},
                        {x: 860 * scaleX, y: 190 * scaleY, width: 20 * scaleX, height: 20 * scaleY, vx: 2 * scaleX, color: '#ff4444', minX: 850 * scaleX, maxX: 930 * scaleX}
                    ]);
                    collectibles.push(...[
                        {x: 110 * scaleX, y: 490 * scaleY, width: 12 * scaleX, height: 12 * scaleY, collected: false},
                        {x: 240 * scaleX, y: 450 * scaleY, width: 12 * scaleX, height: 12 * scaleY, collected: false},
                        {x: 370 * scaleX, y: 400 * scaleY, width: 12 * scaleX, height: 12 * scaleY, collected: false},
                        {x: 500 * scaleX, y: 350 * scaleY, width: 12 * scaleX, height: 12 * scaleY, collected: false},
                        {x: 630 * scaleX, y: 300 * scaleY, width: 12 * scaleX, height: 12 * scaleY, collected: false},
                        {x: 760 * scaleX, y: 250 * scaleY, width: 12 * scaleX, height: 12 * scaleY, collected: false},
                        {x: 870 * scaleX, y: 190 * scaleY, width: 12 * scaleX, height: 12 * scaleY, collected: false},
                        {x: 180 * scaleX, y: 320 * scaleY, width: 12 * scaleX, height: 12 * scaleY, collected: false},
                        {x: 430 * scaleX, y: 220 * scaleY, width: 12 * scaleX, height: 12 * scaleY, collected: false},
                        {x: 680 * scaleX, y: 120 * scaleY, width: 12 * scaleX, height: 12 * scaleY, collected: false}
                    ]);
                    break;

                default:
                    let platformCount = Math.min(5 + level, 15);
                    let enemyCount = Math.min(2 + Math.floor(level/2), 10);
                    let collectibleCount = Math.min(3 + level, 12);

                    for(let i = 0; i < platformCount; i++) {
                        platforms.push({
                            x: Math.random() * (canvas.width - 100 * scaleX),
                            y: 150 * scaleY + Math.random() * 350 * scaleY,
                            width: (80 + Math.random() * 100) * scaleX,
                            height: (15 + Math.random() * 10) * scaleY,
                            color: Math.random() > 0.7 ? '#ffff00' : '#ff00ff'
                        });
                    }

                    for(let i = 0; i < enemyCount; i++) {
                        let platform = platforms[Math.floor(Math.random() * platforms.length)];
                        enemies.push({
                            x: platform.x + 10 * scaleX,
                            y: platform.y - 25 * scaleY,
                            width: 20 * scaleX,
                            height: 20 * scaleY,
                            vx: (Math.random() > 0.5 ? 1 : -1) * (1 + Math.random() * 2) * scaleX,
                            color: '#ff4444',
                            minX: platform.x,
                            maxX: platform.x + platform.width - 20 * scaleX
                        });
                    }

                    for(let i = 0; i < collectibleCount; i++) {
                        let platform = platforms[Math.floor(Math.random() * platforms.length)];
                        collectibles.push({
                            x: platform.x + Math.random() * (platform.width - 15 * scaleX),
                            y: platform.y - 20 * scaleY,
                            width: 12 * scaleX,
                            height: 12 * scaleY,
                            collected: false
                        });
                    }
            }
        }

        function handleInput() {
            if (touchControls.left) {
                player.vx = -player.speed;
            } else if (touchControls.right) {
                player.vx = player.speed;
            } else {
                player.vx *= 0.8;
            }

            if (touchControls.jump && player.onGround) {
                player.vy = -player.jumpPower;
                player.onGround = false;
                touchControls.jump = false;
            }

            if (keys['KeyA'] || keys['ArrowLeft']) {
                player.vx = -player.speed;
            } else if (keys['KeyD'] || keys['ArrowRight']) {
                player.vx = player.speed;
            }

            if ((keys['KeyW'] || keys['ArrowUp'] || keys['Space']) && player.onGround) {
                player.vy = -player.jumpPower;
                player.onGround = false;
            }
        }

        function updatePlayer() {
            player.vy += 0.8;
            player.x += player.vx;
            player.y += player.vy;

            player.trail.push({x: player.x + player.width/2, y: player.y + player.height/2});
            if (player.trail.length > 10) player.trail.shift();

            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
            if (player.y > canvas.height) {
                lives--;
                if (lives <= 0) gameOver();
                else resetPlayer();
            }

            player.onGround = false;
        }

        function checkCollisions() {
            platforms.forEach(platform => {
                if (player.x < platform.x + platform.width &&
                    player.x + player.width > platform.x &&
                    player.y < platform.y + platform.height &&
                    player.y + player.height > platform.y) {
                    
                    if (player.vy > 0 && player.y < platform.y) {
                        player.y = platform.y - player.height;
                        player.vy = 0;
                        player.onGround = true;
                    }
                }
            });

            enemies.forEach(enemy => {
                if (player.x < enemy.x + enemy.width &&
                    player.x + player.width > enemy.x &&
                    player.y < enemy.y + enemy.height &&
                    player.y + player.height > enemy.y) {
                    
                    lives--;
                    if (lives <= 0) gameOver();
                    else resetPlayer();
                }
            });

            collectibles.forEach(item => {
                if (!item.collected &&
                    player.x < item.x + item.width &&
                    player.x + player.width > item.x &&
                    player.y < item.y + item.height &&
                    player.y + player.height > item.y) {
                    
                    item.collected = true;
                    score += 100;
                    
                    if (collectibles.every(c => c.collected)) {
                        level++;
                        generateLevel();
                        resetPlayer();
                    }
                }
            });
        }

        function updateEnemies() {
            enemies.forEach(enemy => {
                enemy.x += enemy.vx;
                
                if (enemy.minX !== undefined && enemy.maxX !== undefined) {
                    if (enemy.x <= enemy.minX || enemy.x >= enemy.maxX) {
                        enemy.vx = -enemy.vx;
                        enemy.x = Math.max(enemy.minX, Math.min(enemy.maxX, enemy.x));
                    }
                }
            });
        }

        function draw() {
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#000033');
            gradient.addColorStop(1, '#000066');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#ffffff';
            for (let i = 0; i < 100; i++) {
                const x = (i * 137.5) % canvas.width;
                const y = (i * 43.7) % canvas.height;
                ctx.fillRect(x, y, 1, 1);
            }

            ctx.strokeStyle = '#ff00ff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            player.trail.forEach((point, i) => {
                if (i === 0) ctx.moveTo(point.x, point.y);
                else ctx.lineTo(point.x, point.y);
            });
            ctx.stroke();

            platforms.forEach(platform => {
                ctx.shadowColor = platform.color;
                ctx.shadowBlur = 10;
                ctx.fillStyle = platform.color;
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
            });

            ctx.shadowColor = player.color;
            ctx.shadowBlur = 15;
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(player.x + player.width * 0.27, player.y + player.height * 0.27, player.width * 0.13, player.height * 0.13);
            ctx.fillRect(player.x + player.width * 0.6, player.y + player.height * 0.27, player.width * 0.13, player.height * 0.13);

            enemies.forEach(enemy => {
                ctx.shadowColor = enemy.color;
                ctx.shadowBlur = 10;
                ctx.fillStyle = enemy.color;
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
            });

            collectibles.forEach(item => {
                if (!item.collected) {
                    ctx.shadowColor = '#ffff00';
                    ctx.shadowBlur = 15;
                    ctx.fillStyle = '#ffff00';
                    ctx.beginPath();
                    ctx.arc(item.x + item.width/2, item.y + item.height/2, item.width/2, 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            ctx.shadowBlur = 0;
        }

        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = level;
            document.getElementById('lives').textContent = lives;
        }

        function gameLoop() {
            if (gameState !== 'playing') return;

            handleInput();
            updatePlayer();
            updateEnemies();
            checkCollisions();
            draw();
            updateUI();

            animationId = requestAnimationFrame(gameLoop);
        }

        function pauseGame() {
            if (gameState === 'playing') {
                gameState = 'paused';
                isPaused = true;
                cancelAnimationFrame(animationId);
                audio.pause();
                
                const pauseOverlay = document.createElement('div');
                pauseOverlay.id = 'pauseOverlay';
                pauseOverlay.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    z-index: 200;
                    color: #fff;
                    font-size: clamp(1.5em, 4vw, 2em);
                    text-shadow: 0 0 20px #ff00ff;
                `;
                pauseOverlay.innerHTML = `
                    <h2 style="margin-bottom: 30px; background: linear-gradient(45deg, #ff00ff, #00ffff); -webkit-background-clip: text; color: transparent;">‚è∏Ô∏è –ò–ì–†–ê –ù–ê –ü–ê–£–ó–ï</h2>
                    <button onclick="resumeGame()" style="background: linear-gradient(45deg, #ff00ff, #00ffff); border: none; padding: clamp(10px, 3vw, 15px) clamp(20px, 5vw, 30px); margin: 10px; font-size: clamp(0.8em, 2.5vw, 1em); color: #000; font-weight: bold; cursor: pointer; border-radius: 25px;">‚ñ∂Ô∏è –ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
                    <button onclick="showMenu()" style="background: linear-gradient(45deg, #ff4444, #ff8800); border: none; padding: clamp(10px, 3vw, 15px) clamp(20px, 5vw, 30px); margin: 10px; font-size: clamp(0.8em, 2.5vw, 1em); color: #000; font-weight: bold; cursor: pointer; border-radius: 25px;">üè† –í –ú–ï–ù–Æ</button>
                `;
                document.getElementById('gameContainer').appendChild(pauseOverlay);
            }
        }

        function resumeGame() {
            const pauseOverlay = document.getElementById('pauseOverlay');
            if (pauseOverlay) pauseOverlay.remove();
            gameState = 'playing';
            isPaused = false;
            if (isMusicPlaying) audio.play().catch(e => console.log('Audio play failed:', e));
            gameLoop();
        }

        function gameOver() {
            gameState = 'gameOver';
            cancelAnimationFrame(animationId);
            audio.pause();
            
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('neonRacerHighScore', highScore);
            }
            
            setTimeout(() => {
                const gameOverOverlay = document.createElement('div');
                gameOverOverlay.id = 'gameOverOverlay';
                gameOverOverlay.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.9);
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    z-index: 200;
                    color: #fff;
                    font-size: clamp(1em, 3vw, 1.5em);
                    text-shadow: 0 0 20px #ff0000;
                `;
                
                const isNewRecord = score === highScore && score > 0;
                gameOverOverlay.innerHTML = `
                    <h2 style="margin-bottom: 20px; background: linear-gradient(45deg, #ff0000, #ff4444); -webkit-background-clip: text; color: transparent; font-size: clamp(1.5em, 4vw, 2em);">üíÄ –ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</h2>
                    ${isNewRecord ? '<p style="color: #ffff00; font-size: clamp(0.9em, 2.5vw, 1.2em); margin-bottom: 10px;">üéâ –ù–û–í–´–ô –†–ï–ö–û–†–î! üéâ</p>' : ''}
                    <p style="margin-bottom: 10px;">–í–∞—à —Å—á–µ—Ç: <span style="color: #00ffff;">${score}</span></p>
                    <p style="margin-bottom: 10px;">–£—Ä–æ–≤–µ–Ω—å: <span style="color: #ff00ff;">${level}</span></p>
                    <p style="margin-bottom: 20px;">–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span style="color: #ffff00;">${highScore}</span></p>
                    <button onclick="startGame(); document.getElementById('gameOverOverlay').remove();" style="background: linear-gradient(45deg, #ff00ff, #00ffff); border: none; padding: clamp(10px, 3vw, 15px) clamp(20px, 5vw, 30px); margin: 10px; font-size: clamp(0.8em, 2.5vw, 1em); color: #000; font-weight: bold; cursor: pointer; border-radius: 25px;">üéÆ –ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
                    <button onclick="showMenu(); document.getElementById('gameOverOverlay').remove();" style="background: linear-gradient(45deg, #ff4444, #ff8800); border: none; padding: clamp(10px, 3vw, 15px) clamp(20px, 5vw, 30px); margin: 10px; font-size: clamp(0.8em, 2.5vw, 1em); color: #000; font-weight: bold; cursor: pointer; border-radius: 25px;">üè† –í –ú–ï–ù–Æ</button>
                `;
                document.getElementById('gameContainer').appendChild(gameOverOverlay);
            }, 100);
        }

        function showMenu() {
            const pauseOverlay = document.getElementById('pauseOverlay');
            const gameOverOverlay = document.getElementById('gameOverOverlay');
            const highScoreOverlay = document.getElementById('highScoreOverlay');
            if (pauseOverlay) pauseOverlay.remove();
            if (gameOverOverlay) gameOverOverlay.remove();
            if (highScoreOverlay) highScoreOverlay.remove();
            
            document.getElementById('menu').classList.remove('hidden');
            document.getElementById('gameCanvas').style.display = 'none';
            document.getElementById('ui').classList.add('hidden');
            document.getElementById('controls').classList.add('hidden');
            document.getElementById('touchControls').classList.add('hidden');
            gameState = 'menu';
            cancelAnimationFrame(animationId);
            audio.pause();
        }

        function showControls() {
            const controlsOverlay = document.createElement('div');
            controlsOverlay.id = 'controlsOverlay';
            controlsOverlay.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 200;
                color: #fff;
                font-size: clamp(1em, 3vw, 1.5em);
                text-shadow: 0 0 20px #00ffff;
                padding: 20px;
            `;
            controlsOverlay.innerHTML = `
                <h2 style="margin-bottom: 20px; background: linear-gradient(45deg, #00ffff, #ff00ff); -webkit-background-clip: text; color: transparent; font-size: clamp(1.5em, 4vw, 2em);">üéÆ –£–ü–†–ê–í–õ–ï–ù–ò–ï</h2>
                <p style="margin-bottom: 10px; text-align: center;">‚Üê ‚Üí (A D) - –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ</p>
                <p style="margin-bottom: 10px; text-align: center;">‚Üë (W SPACE) - –ø—Ä—ã–∂–æ–∫</p>
                <p style="margin-bottom: 10px; text-align: center;">ESC - –ø–∞—É–∑–∞/–º–µ–Ω—é</p>
                <p style="margin-bottom: 20px; text-align: center;">üì± –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ–Ω—Å–æ—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏</p>
                <p style="margin-bottom: 20px; text-align: center;">üéØ –¶–ï–õ–¨: –°–æ–±–µ—Ä–∏ –≤—Å–µ –∂–µ–ª—Ç—ã–µ —Å—Ñ–µ—Ä—ã –∏ –∏–∑–±–µ–≥–∞–π –∫—Ä–∞—Å–Ω—ã—Ö –≤—Ä–∞–≥–æ–≤!</p>
                <button onclick="showMenu(); document.getElementById('controlsOverlay').remove();" style="background: linear-gradient(45deg, #ff4444, #ff8800); border: none; padding: clamp(10px, 3vw, 15px) clamp(20px, 5vw, 30px); margin: 10px; font-size: clamp(0.8em, 2.5vw, 1em); color: #000; font-weight: bold; cursor: pointer; border-radius: 25px;">üè† –í –ú–ï–ù–Æ</button>
            `;
            document.getElementById('gameContainer').appendChild(controlsOverlay);
        }

        function showHighScore() {
            const highScoreOverlay = document.createElement('div');
            highScoreOverlay.id = 'highScoreOverlay';
            highScoreOverlay.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 200;
                color: #fff;
                font-size: clamp(1em, 3vw, 1.5em);
                text-shadow: 0 0 20px #ffff00;
                padding: 20px;
            `;
            
            const isNewRecord = score > highScore && score > 0;
            if (isNewRecord) {
                highScore = score;
                localStorage.setItem('neonRacerHighScore', highScore);
            }

            highScoreOverlay.innerHTML = `
                <h2 style="margin-bottom: 20px; background: linear-gradient(45deg, #ffff00, #ff8800); -webkit-background-clip: text; color: transparent; font-size: clamp(1.5em, 4vw, 2em);">üèÜ –†–ï–ö–û–†–î–´</h2>
                ${isNewRecord ? '<p style="color: #ffff00; font-size: clamp(0.9em, 2.5vw, 1.2em); margin-bottom: 10px;">üéâ –ù–û–í–´–ô –†–ï–ö–û–†–î! üéâ</p>' : ''}
                <div style="background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #ffff00;">
                    <p style="margin-bottom: 10px;">–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span style="color: #ffff00;">${highScore}</span></p>
                    <p style="margin-bottom: 10px;">–¢–µ–∫—É—â–∏–π —Å—á–µ—Ç: <span style="color: #00ffff;">${score}</span></p>
                </div>
                <button onclick="showMenu(); document.getElementById('highScoreOverlay').remove();" style="background: linear-gradient(45deg, #ff4444, #ff8800); border: none; padding: clamp(10px, 3vw, 15px) clamp(20px, 5vw, 30px); margin: 10px; font-size: clamp(0.8em, 2.5vw, 1em); color: #000; font-weight: bold; cursor: pointer; border-radius: 25px;">üè† –í –ú–ï–ù–Æ</button>
            `;
            document.getElementById('gameContainer').appendChild(highScoreOverlay);
        }

        init();
    </script>
</body>
</html>
